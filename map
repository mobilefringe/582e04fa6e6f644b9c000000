<div class="row">
    <div class="trim_screen job_page">
        <h1>Centre Map</h1>
        <div class="col-md-4">
            <select id="store_select_container" class="form-control select_store">
                <option value="None">Select a Store</option>
                <script id="store_select_template" type="x-tmpl-mustache/text">
                    <option value="{{id}}" data-value="{{x_coordinate}},{{y_coordinate}},{{id}}">{{name}}</option>
                </script>
            </select>
        </div>
        <div class="col-md-8">
            <a href="http://uppercanadamall.com/system/site_images/photos/000/019/685/original/UCM16278-May-TearSheet-v6.pdf?1466701128" target="_blank" class="pull-right download_map_btn">Download Map</a>
        </div>
	    
	    <!--<div id="parent_div">-->
    	<!--	<div id="zoom_container_directory"  >-->
    	<!--		<img alt="Ucm_map_1" id="map_image" src="https://www.mallmaverick.com/system/properties/maps/000/000/011/original/ucm_map_1.jpg?1435606610" />-->
    	<!--		<div class="landmarks" data-show-at-zoom="100" data-allow-drag="true"></div>-->
    	<!--	</div>-->
    	<!--</div>-->
	    <div class="">
            <div id="zoom_container">
                <img id="png_map" class="png_map" alt="center map" src="" />
                <div class="landmarks" data-show-at-zoom="100" data-allow-drag="true"></div>    
            </div>
        </div>

        
    </div>
</div>
<script src="//kodekloud.s3.amazonaws.com/sites/54d4e9206e6f64691f000000/d9e054e28dd1bad70a952dd85777e93f/jquery.smoothZoom.min.js"></script>
<script>
    $(document).ready(function(){
        function renderAll(){
            var stores = getStoresList();
            console.log(stores);
            renderStoreList('#store_select_container','#store_select_template', stores, "stores");
            
            $("#png_map").attr("src", getPNGMapURL())
        		$('#png_map').smoothZoom({
        		    height: 738,
        		    width: 1389,
        		    initial_ZOOM: 0,
        			zoom_MIN: 0,
        			zoom_MAX: 300,
        			responsive: true,
        		    responsive_maintain_ratio: true,
        			zoom_BUTTONS_SHOW : 'YES',
        			pan_BUTTONS_SHOW : 'NO',
        			pan_LIMIT_BOUNDARY : 'NO',
        			button_SIZE: 34,
        			button_ALIGN: "top right",
        			zoom_OUT_TO_FIT: "NO",
        			container: 'zoom_container'
        		});
        		
        	show_png_pin(".select_store", "#png_map");
        }
        
        function show_png_pin(trigger, map){
            $(trigger).bind("change", function(e) {
                e.preventDefault()
                
                var selectedOption = $("select.select_store").val();
                
                var isMobile = ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) );
                coords = $(selectedOption).attr('data-value').split(",");
                var zoomData = $(map).smoothZoom('getZoomData');
                x_coord = parseInt(coords[0])
                y_coord = parseInt(coords[1])
                floor = (coords[3])
                
                name = $(selectedOption).text();
                $(map).smoothZoom('removeLandmark')
                if (isMobile) {
                    $(map).smoothZoom('focusTo', {x:x_coord, y:y_coord, zoom:200});    
                } else {
                    $(map).smoothZoom('focusTo', {x:x_coord, y:y_coord, zoom:300});
                }
                
                $(map).smoothZoom('addLandmark', 
        			[
        			'<div class="item mark" data-show-at-zoom="0" data-position="'+x_coord+','+y_coord+'">\
        				<div>\
        					<div class="text">\
        					<strong>'+ name+ '</strong>\
        				</div>\
        				<img src="//codecloud.cdn.speedyrails.net/sites/54cfab316e6f6433ad020000/530d3a9b7bc13ce4a511089c23463f99/10dundas_pin.png" width="40px" height="59px" alt="marker" />\
        				</div>\
        			</div>'
        			]
        		);
            });
        }
        
        
        loadMallDataCached(renderAll); 
    })
</script>