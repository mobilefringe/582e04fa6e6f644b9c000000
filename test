<div class="row">
    <div class="trim_screen">
        <h1>Store List</h1>
            <div class="row">
                <div class="col-md-9">    
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="alphabetical">
                            <h4>Stores A-Z</h4>
                            <div class="store_list" id="store_list_container">
                                <script id="store_list_template" type="x-tmpl-mustache/text">
                                    <div class="store_list_content">
                                        
                                            <div class="col-md-12">
                                                <p class="store_initial hstc" style="{{show}}" id="{{initial}}">{{initial}}</p>
                                                <a href="#top" class="pull-right stores_gotop">
                                                    <img src="//www.mallmaverick.com/system/site_images/photos/000/000/280/original/icon_gotop.png?1370370003">
                                                </a>
                                            </div>
                                       
                                        <div class="row">
                                            <div class="col-md-7 col-xs-9">
                                                <p class="store_name"><a href="/stores/{{slug}}">{{name}}</a></p>
                                            </div>
                                            <div class="col-md-5 col-xs-3">
                                                <p class="store_list_name pull-right">
                                                    <span style="{{new_store}}" class="has_new">New</span>
                                                    <span class="has_sale" style="{{promotion_exist}}">SALE</span>
                                                    <a style="{{phone_exist}}" href="tel:{{phone}}"><i class="fa fa-phone visible-xs-inline-block" aria-hidden="true"></i><span class="store_phone hidden-xs">{{phone}}</span></a>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </script>
                            </div>
                               
                            
                        </div>
                        <div role="tabpanel" class="tab-pane" id="categories">
                            <div class="store_list" id="category_list_container">
                                <script id="category_list_template" type="x-tmpl-mustache/text">
                                    <div class="store_list_content {{block}}">
                                        <p class="store_initial" style="{{show}}">{{header}}</p>
                                        <p class="store_name"><a href="/stores/{{slug}}">{{name}}</a></p>
                                    </div>
                                </script>
                            </div>
                        </div>
                    </div>
                </div>    
                
                
                
                <div class="col-md-3">
                    <a class="active hstc" href="#alphabetical" aria-controls="alphabetical" role="tab" data-toggle="tab">
                        <h3>Stores A-Z</h3>
                    </a>    
                    <p class="alpha_list">
                        <a href="#A">A</a>
                        <a href="#B">B</a>
                        <a href="#C">C</a>
                        <a href="#D">D</a>
                        <a href="#E">E</a>
                        <a href="#F">F</a>
                        <a href="#G">G</a>
                        <a href="#H">H</a>
                        <a href="#I">I</a>
                        <a href="#J">J</a>
                        <a href="#K">K</a>
                        <a href="#L">L</a>
                        <a href="#M">M</a>
                        <a href="#N">N</a>
                        <a href="#O">O</a>
                        <a href="#P">P</a>
                        <a href="#Q">Q</a>
                        <a href="#R">R</a>
                        <a href="#S">S</a>
                        <a href="#T">T</a>
                        <a href="#U">U</a>
                        <a href="#V">V</a>
                        <a href="#W">W</a>
                        <a href="#X">X</a>
                        <a href="#Y">Y</a>
                        <a href="#Z">Z</a>
                    </p>
                    <a class="hstc" href="#categories" aria-controls="categories" role="tab" data-toggle="tab">
                        <h3>Catetegories</h3>
                    </a>
                </div>    
            </div>

    </div>
</div>
<script>
    $(document).ready(function(e){
        function renderAll (){
            var stores = getStoresList();
            var categories = getStoreCategories();
            var half = Math.ceil(categories.length / 2)
            var leftSide = categories.splice(0, half);
            var rightSide = categories
            
            renderStoreList('#store_list_container','#store_list_template', stores, "stores", "A", "M");
            renderStoreList('#store_list_container_right','#store_list_template_right', stores, "stores", "M", "Z");
            renderStoreListCatetories('#category_list_container','#category_list_template', leftSide, stores);
            renderStoreListCatetories('#category_list_container_right','#category_list_template_right', rightSide, stores);
        }
        
        loadMallDataCached(renderAll); 
        
        $(".switch_store button").click(function(){
            $("#category").hide();
            $("#list").show();    
            location.hash = "#" + $(this).text();
        })
        
        $(".switch_category button").click(function(){            
            $("#list").hide();            
            $("#category").show();
            location.hash = "#" + $(this).attr("name");
        })
        
        function renderStoreListCatetories(container, template, category_list,stores){
    var item_rendered = [];
    var template_html = $(template).html();
    Mustache.parse(template_html);   // optional, speeds up future use
    var initial_id = 0;
    var category_index = 0;
    $.each(category_list , function( key, category ) {
        var category_id = parseInt(category.id);
        var category_name = category.name;
        var current_id = category.id;
        var count = 0;
        
        $.each( stores , function( i, store ) {
            var store_category = store.categories;
            var a = store.categories.indexOf(category_id);
            
            if(a > -1){
                if (count == 0){
                    store.show  = "display:block"; 
                }else{
                    store.show  = "display:none"; 
                }
                store.header = category_name;
                store.block = category.id;
                var rendered = Mustache.render(template_html,store);
                item_rendered.push(rendered);
                count += 1;
            }
            
        });
        category_index += 1;
    
    });
    $(container).show();
    $(container).html(item_rendered.join(''));
}
    })
</script>