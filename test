<style>
    .stores_table_headers {
        width: 90%;
    }
    .store_initial {
        display: inline-block;
    }
    .store_row_name p {
        display: inline-block;
    }
    i.fa.fa-phone {
        font-size: 24px;
    }
</style>

<div class="row">
    <div class="trim_screen">
        <h1>Store List</h1>
        <div class="row">
            <div class="col-md-3 col-md-push-9">
                <a class="store_tab_toggle" href="#alphabetical" aria-controls="alphabetical" role="tab" data-toggle="tab">
                    <h3>Stores A-Z</h3>
                </a>    
                <div class="alphabet_bg switch_store">
                    <button class="btn-secondary" onClick="parent.location='#A'">A</button>
                    <button class="btn-secondary" onClick="parent.location='#B'">B</button>
                    <button class="btn-secondary" onClick="parent.location='#C'">C</button>
                    <button class="btn-secondary" onClick="parent.location='#D'">D</button>
                    <button class="btn-secondary" onClick="parent.location='#E'">E</button>
                    <button class="btn-secondary" onClick="parent.location='#F'">F</button>
                    <button class="btn-secondary" onClick="parent.location='#G'">G</button>
                    <button class="btn-secondary" onClick="parent.location='#H'">H</button>
                    <button class="btn-secondary" onClick="parent.location='#I'">I</button>
                    <button class="btn-secondary" onClick="parent.location='#J'">J</button>
                    <button class="btn-secondary" onClick="parent.location='#K'">K</button>
                    <button class="btn-secondary" onClick="parent.location='#L'">L</button>
                    <button class="btn-secondary" onClick="parent.location='#M'">M</button>
                    <button class="btn-secondary" onClick="parent.location='#N'">N</button>
                    <button class="btn-secondary" onClick="parent.location='#O'">O</button>
                    <button class="btn-secondary" onClick="parent.location='#P'">P</button>
                    <button class="btn-secondary" onClick="parent.location='#Q'">Q</button>
                    <button class="btn-secondary" onClick="parent.location='#R'">R</button>
                    <button class="btn-secondary" onClick="parent.location='#S'">S</button>
                    <button class="btn-secondary" onClick="parent.location='#T'">T</button>
                    <button class="btn-secondary" onClick="parent.location='#U'">U</button>
                    <button class="btn-secondary" onClick="parent.location='#V'">V</button>
                    <button class="btn-secondary" onClick="parent.location='#W'">W</button>
                    <button class="btn-secondary" onClick="parent.location='#X'">X</button>
                    <button class="btn-secondary" onClick="parent.location='#Y'">Y</button>
                    <button class="btn-secondary" onClick="location.href='Z'">Z</button>
                </div>
                <a class="store_tab_toggle" href="#categories" aria-controls="categories" role="tab" data-toggle="tab">
                    <h3>Catetegories</h3>
                </a>
                <div class="switch_category" id="category_container_phone">
                    <script id="category_template_phone" type="x-tmpl-mustache/text">
                        <button class="btn-secondary category_btn" onClick="parent.location='#{{id}}'" name="{{id}}">{{name}}</button>
                    </script>
                </div>
            </div>    
        
        
        
            <div class="col-md-9 col-md-pull-3">    
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="alphabetical">
                        <!--<h4 class="">Stores A-Z</h4>-->
                        <div class="store_list" id="store_list_container">
                            <script id="store_list_template" type="x-tmpl-mustache/text">
                                <div class="store_list_content">
                                    <h3 class="stores_table_headers" style="{{show}}">
                                        <a class="store_initial"  id="{{initial}}">{{initial}}</a>
                                        <a href="#top" class="pull-right stores_gotop">
                                            <img src="//www.mallmaverick.com/system/site_images/photos/000/000/280/original/icon_gotop.png?1370370003">
                                        </a>
                                    </h3>
                                    <div class="store_row_name">
                                        <a href="/stores/{{slug}}">{{name}}</a>
                                        <div class="stores_row pull-right">
                                            <span class="has_sale" style="{{promotion_exist}}">SALE</span>
                                            <span class="has_new" style="{{new_store}}">New</span>
                                            <span class="store_phone hidden-xs">{{phone}}</span>
                                            <a class="visible-xs-inline-block"style="{{phone_exist}}" href="tel:{{phone}}">
                                                <i class="fa fa-phone" aria-hidden="true"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </script>
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="categories">
                        <div class="store_list" id="category_list_container">
                            <script id="category_list_template" type="x-tmpl-mustache/text">
                                <div class="store_list_content {{block}}">
                                    <h3 class="stores_table_headers" style="{{show}}">
                                        <a class="store_initial" id="{{id}}">{{header}}</a>
                                        <a href="#top" class="pull-right stores_gotop">
                                            <img src="//www.mallmaverick.com/system/site_images/photos/000/000/280/original/icon_gotop.png?1370370003">
                                        </a>
                                    </h3>
                                    <div class="store_row_name">
                                        <p class=><a href="/stores/{{slug}}">{{name}}</a></p>
                                        <div class="store_list_name pull-right">
                                            <span style="{{new_store}}" class="has_new">New</span>
                                            <span class="has_sale" style="{{promotion_exist}}">SALE</span>
                                            <a style="{{phone_exist}}" href="tel:{{phone}}"><i class="fa fa-phone visible-xs-inline-block" aria-hidden="true"></i><span class="store_phone hidden-xs">{{phone}}</span></a>
                                        </div>
                                    </div>
                                </div>
                            </script>
                        </div>
                    </div>
                </div>
            </div>    
            
            
            
            
        </div>
    </div>
</div>
<script>
    $(document).ready(function(e){
        function renderAll (){
            var stores = getStoresList();
            var categories = getStoreCategories();
            var half = Math.ceil(categories.length / 2)
            var leftSide = categories.splice(0, half);
            var rightSide = categories
            
            renderStoreList('#store_list_container','#store_list_template', stores, "stores");
            renderStoreList('#store_list_container_right','#store_list_template_right', stores, "stores");
            renderStoreListCatetories('#category_list_container','#category_list_template', leftSide, stores);
            renderGeneral('#category_container_phone', '#category_template_phone', categories);
        }
        
        loadMallDataCached(renderAll); 
        
        $(".switch_store button").click(function(){
            $("#category").hide();
            $("#list").show();    
            location.hash = "#" + $(this).text();
        })
        
        $(".switch_category button").click(function(){            
            $("#list").hide();            
            $("#category").show();
            location.hash = "#" + $(this).attr("name");
        })
        
        function renderStoreListCatetories(container, template, category_list,stores){
            var item_rendered = [];
            var template_html = $(template).html();
            Mustache.parse(template_html);   // optional, speeds up future use
            var initial_id = 0;
            var category_index = 0;
            $.each(category_list , function( key, category ) {
                var category_id = parseInt(category.id);
                var category_name = category.name;
                var current_id = category.id;
                var count = 0;
                
                $.each( stores , function( i, store ) {
                    var store_category = store.categories;
                    var a = store.categories.indexOf(category_id);
                    
                    if (a > -1){
                        if (count == 0){
                            store.show  = "display:block"; 
                        }else{
                            store.show  = "display:none"; 
                        }
                        store.header = category_name;
                        store.block = category.id;
                        var rendered = Mustache.render(template_html,store);
                        item_rendered.push(rendered);
                        count += 1;
                    }
                });
                category_index += 1;
            });
            $(container).html(item_rendered.join(''));
        }
    })
</script>